import { writeFileSync } from 'fs'
import readInstructions from '../parse-instructions'

// TODO type definition
const rev = require('git-rev-sync')

const OUT_FILE = process.argv[2]

//
// Script to generate opcode constants for the
// C interpreter.
//
const constants = readInstructions()
  .map(({ mnemonic, opcode }) =>
    `static const int ${mnemonic.toUpperCase()} = ${opcode};`
  )

const C_CODE =
`/**
 * GENERATED BY build/gen-c-opcodes.ts
 * ${new Date().toUTCString()}
 * Revision ${rev.short()}
 **/
${constants.join('\n')}

/**
 * End generated file
 **/
`

writeFileSync(OUT_FILE, C_CODE, 'utf8')
